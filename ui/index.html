<!DOCTYPE html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="stylesheet.css">
</head>
<body>
    <nav class="navbar navbar-expand-sm bg-light navbar-dark">
        <a class="navbar-brand">Penn State Undergraduate Application</a>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-2"></div>
            <div class="col-lg-8">
                <p class="default-instructions">As part of the application process, you will share your academic record from high school. Select the upload button and an image or PDF file of your transcript to begin. After your upload, you will have the chance to verify all information is correct.</p>
            </div>
            <div class="col-lg-2"></div>
        </div>
        <div class="row justify-content-center h-100">
            <div class="col-lg-2"></div>
            <div class="col-lg-8">
                <form id="upload-container">
                    <div class="container-fluid d-flex">
                        <div class="row justify-content-center align-self-center w-100">
                            <i id="upload-icon" class="material-icons">cloud_upload</i>
                            <input id="transcript-upload" name="files[]" type="file">
                            <label class="w-100" for="transcript-upload"><strong>Choose a file</strong><span id="can-drag-drop"> or drag it here</span>.</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-lg-2"></div>
        </div>
        <div class="row justify-content-center">
            <button id="upload-next-button" class="btn btn-outline-primary">Next >>></button>
        </div>
    </div>
    <div class="modal fade" id="uploading-modal">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="d-flex justify-content-center">
                        <span class="spinner-border text-dark" role="status"></span>
                    </div>
                    <h4 class="w-100 text-center mt-2">Uploading transcript...</h4>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="user-info-modal">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Personal Information</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="user-full-name" class="mr-sm-2">Full Name:</label>
                            <input type="text" class="form-control" id="user-full-name">
                        </div>
                        <div class="form-group">
                            <label for="user-address" class="mr-sm-2">Home Address:</label>
                            <input type="text" class="form-control" id="user-address">
                        </div>
                        <div class="form-group">
                            <label for="user-gpa" class="mr-sm-2">GPA:</label>
                            <input type="text" class="form-control" id="user-gpa">
                        </div>
                        <div class="form-group">
                            <label for="user-sat" class="mr-sm-2">SAT Score:</label>
                            <input type="text" class="form-control" id="user-sat">
                        </div>
                        <button id="skip-pi" type="button" class="btn btn-outline-danger">Skip</button>
                        <button id="submit-pi" type="button" class="btn btn-outline-primary float-right">Advance >>></button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="hs-info-modal">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">High School Information</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="hs-name" class="mr-sm-2">High School Name:</label>
                            <input type="text" class="form-control" id="hs-name">
                        </div>
                        <div class="form-group">
                            <label for="hs-address" class="mr-sm-2">High School Address:</label>
                            <input type="text" class="form-control" id="hs-address">
                        </div>
                        <div class="form-group">
                            <label for="hs-phone" class="mr-sm-2">High School Phone Number:</label>
                            <input type="text" class="form-control" id="hs-phone">
                        </div>
                        <button id="skip-hs" type="button" class="btn btn-outline-danger">Skip</button>
                        <button id="submit-hs" type="button" class="btn btn-outline-primary float-right">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script src="js/utils.js"></script>
    <script src="js/grab.js"></script>
    <script src="js/posts.js"></script>
    <script>
        var hasDroppedFile = false;
        var uploadForm = $('#upload-container');
        var droppedFile;
        var loadingModal = $('#uploading-modal');

        $(document).ready(function(){
            $('#user-info-modal').modal();
        });

        $('#skip-pi').click(function(){
            $('#user-info-modal').modal('hide');
        });

        $('#submit-pi').click(function(){
            sessionStorage.setItem("name", $('#user-full-name').val());
            sessionStorage.setItem("address", $('#user-address').val());
            sessionStorage.setItem("gpa", $('#user-gpa').val());
            sessionStorage.setItem("sat", $('#user-sat').val());
            $('#user-info-modal').modal('hide');
            $('#hs-info-modal').modal();
        });

        $('#skip-hs').click(function(){
            $('#hs-info-modal').modal('hide');
        });

        $('#submit-hs').click(function(){
            sessionStorage.setItem("hs-name", $('#hs-name').val());
            sessionStorage.setItem("hs-address", $('#hs-address').val());
            sessionStorage.setItem("hs-phone", $('#hs-phone').val());
            $('#hs-info-modal').modal('hide');
        });

        uploadForm.on('drag dragstart dragend dragover dragenter dragleave drop', function(e){
            e.preventDefault();
            e.stopPropagation();
        }).on('dragover dragenter', function(){
            uploadForm.addClass('is-drag-over');
        }).on('dragleave dragend drop', function(){
            uploadForm.removeClass('is-drag-over')
        }).on('drop', function(e){
            droppedFile = e.originalEvent.dataTransfer.files;
        });

        $('#upload-next-button').click(function(){
            loadingModal.modal();
            var fileEntry = $('#transcript-upload').prop("files")[0];
            var fileReader = new FileReader();
            fileReader.addEventListener("load", function(){
                var file = fileReader.result;
                sessionStorage.setItem("file", file);
                sendFilePost(file, handleFilePostResult);
            });
            if(fileEntry){
                //File exists - read
                fileReader.readAsDataURL(fileEntry);
            }
        });

        var handleFilePostResult = function(parseReturn){
            //TODO: validate we actually got something back
            sessionStorage.setItem("parseResult", JSON.stringify(parseReturn));
            window.location.href = "review_transcript.html";
        }
    </script>
</body>