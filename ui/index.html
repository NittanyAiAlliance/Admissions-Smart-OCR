<!DOCTYPE html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>Transcript Image Upload</title>
</head>
<body>
    <p>Upload file:</p>
    <input id="file-upload-input" type="file">
    <button type="button" id="file-upload-button">Upload</button>
    <script src="js/utils.js"></script>
    <script src="js/grab.js"></script>
    <script src="js/posts.js"></script>
    <script>
        $(document).ready(function(){
            $('#file-upload-button').click(handleFileUploadClick);
            getApiToken(handleApiToken);
        });
        /**
         * Handle API response to request for a token
         * @param apiResponse return from get token request
         */
        let handleApiToken = function(apiResponse){
            if(apiResponse.success){
                //Received token - set to session
                setToken(apiResponse.token);
            } else {
                //Server refused to give us a token
                alert("Error: Server rejected connection");
            }
        };
        /**
         * Handle file upload button click
         */
        let handleFileUploadClick = function(){
            //Get file from DOM element
            let fileEntry = $('#file-upload-input').prop("files")[0];
            let fileReader = new FileReader();
            fileReader.addEventListener("load", function(){
                //File has been loaded ~ send to server
                let file = fileReader.result;
                sendFilePost(file, handleFilePostResult);
            });
            //Load file if it exists
            if(fileEntry){
                //File exists - read
                fileReader.readAsDataURL(fileEntry);
            } else {
                //File does not exist
                console.log("Could not load image");
            }
        };
        /**
         * Handle the return of a file post request
         */
        let handleFilePostResult = function(){
        }
    </script>
</body>